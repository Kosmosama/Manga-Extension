<div class="page-wrapper">
    <div class="toolbar" aria-label="Manga controls">
        <div class="search-group">
            <input type="search" [value]="searchQuery()" (input)="onSearchInput($any($event.target)?.value)"
                placeholder="{{ 'search.placeholder' | transloco }}" class="search-input"
                aria-label="{{ 'search.placeholder' | transloco }}" />
            @if (searchQuery()) {
            <button (click)="clearSearch()" aria-label="{{ 'search.clear' | transloco }}">âœ•</button>
            }
        </div>

        <button (click)="toggleSort()" class="sort-btn" aria-label="{{ 'manga.sort.label' | transloco }}">
            {{ 'manga.sort.label' | transloco }}:
            <strong>
                {{ sortOrder() === 'asc' ? ('manga.sort.asc' | transloco) : ('manga.sort.desc' | transloco) }}
            </strong>
        </button>

        <button (click)="toggleViewMode()" class="view-btn"
            [attr.aria-label]="viewMode() === 'grid' ? ('manga.view.list' | transloco) : ('manga.view.grid' | transloco)">
            {{ viewMode() === 'grid' ? ('manga.view.list' | transloco) : ('manga.view.grid' | transloco) }}
        </button>

        <button (click)="openForm()" class="add-btn" aria-label="{{ 'actions.add' | transloco }}">
            {{ 'actions.add' | transloco }}
        </button>
    </div>

    <tag-filter-bar />

    @if (loading()) {
    <div class="skeleton-container" [class.list-mode]="viewMode() === 'list'">
        @for (item of [1,2,3,4,5,6]; track item) {
        <skeleton kind="card" />
        }
    </div>
    } @else {
    @if (!hasResults()) {
    <p class="empty-state" role="status">{{ 'manga.empty' | transloco }}</p>
    } @else {
    @if (useVirtualScroll()) {
    <virtual-scroll-container [items]="mangaList()" [itemHeight]="260">
        <div class="manga-collection virtual" [attr.role]="effectiveCollectionRole()" tabindex="0"
            (keydown)="onCollectionKeydown($event)">
            @for (m of mangaList(); track m.id; let i = $index) {
            <manga-card [manga]="m" [handleEdit]="handleEdit" (deleted)="handleMangaDeletion($event)"
                [attr.data-card-index]="i" [tabIndexValue]="focusIndex() === i ? 0 : -1"
                [focused]="focusIndex() === i" />
            }
        </div>
    </virtual-scroll-container>
    } @else {
    <div class="manga-collection" [class.list-mode]="viewMode() === 'list'" [attr.role]="effectiveCollectionRole()"
        tabindex="0" (keydown)="onCollectionKeydown($event)" aria-label="{{ viewMode() === 'grid'
            ? ('accessibility.mangaCard.gridNavigationInfo' | transloco)
            : ('accessibility.mangaCard.listNavigationInfo' | transloco) }}">
        @for (m of mangaList(); track m.id; let i = $index) {
        <manga-card [manga]="m" [handleEdit]="handleEdit" (deleted)="handleMangaDeletion($event)"
            [class.list-item]="viewMode() === 'list'" [attr.data-card-index]="i"
            [tabIndexValue]="focusIndex() === i ? 0 : -1" [focused]="focusIndex() === i" />
        }
    </div>
    }
    }
    }

    <modal #modal>
        <h3>{{ selectedManga() ? ('actions.edit' | transloco) : ('actions.add' | transloco) }}</h3>
        <manga-form [manga]="selectedManga()" (formSumbitted)="handleFormSumbission($event); modal.close()" />
    </modal>

    <modal #editModal>
        <h3>{{ 'actions.edit' | transloco }}</h3>
        <manga-form [manga]="selectedManga()" (formSumbitted)="handleFormSumbission($event); editModal.close()" />
    </modal>
</div>