<form [formGroup]="mangaForm" (ngSubmit)="submit()" novalidate>
    <div class="form-group">
        <label for="title">{{ 'form.title.label' | transloco }}</label>
        <input id="title" formControlName="title" [placeholder]="'form.title.placeholder' | transloco" required
            autocomplete="off" />
        @if (mangaForm.get('title')?.touched && mangaForm.get('title')?.invalid) {
        <div class="error">
            @if (mangaForm.get('title')?.errors?.['required']) { {{ 'errors.title.required' | transloco }} }
            @if (mangaForm.get('title')?.errors?.['minlength']) { {{ 'errors.title.minLength' | transloco }} }
            @if (mangaForm.get('title')?.errors?.['titleTaken']) { {{ 'errors.title.duplicate' | transloco }} }
        </div>
        }
    </div>

    <div class="form-group">
        <label for="link">{{ 'form.link.label' | transloco }}</label>
        <input id="link" formControlName="link" [placeholder]="'form.link.placeholder' | transloco"
            autocomplete="off" />
        @if (mangaForm.get('link')?.touched && mangaForm.get('link')?.errors?.['urlInvalid']) {
        <div class="error">{{ 'errors.link.invalid' | transloco }}</div>
        }
    </div>

    <div class="form-group">
        <label for="image">{{ 'form.image.label' | transloco }}</label>
        <input id="image" formControlName="image" [placeholder]="'form.image.placeholder' | transloco"
            autocomplete="off" />
        @if (mangaForm.get('image')?.touched && mangaForm.get('image')?.errors?.['urlInvalid']) {
        <div class="error">{{ 'errors.image.invalid' | transloco }}</div>
        }
    </div>

    @if (imagePreviewUrl()) {
    <div class="image-preview-wrapper">
        <div class="preview-label">{{ 'form.image.label' | transloco }} (preview)</div>
        <div class="preview-box" [class.loading]="imageLoading()" [class.error]="imageError()">
            <img [src]="imagePreviewUrl()" (load)="onPreviewLoad()" (error)="onPreviewError()"
                [attr.alt]="imageError() ? ('accessibility.image.altFallback' | transloco) : (mangaForm.get('title')?.value || 'Image preview')" />
            @if (imageLoading()) { <div class="preview-status">Loading...</div> }
            @if (imageError()) { <div class="preview-status error-text">{{ 'accessibility.image.altFallback' | transloco
                }}</div> }
        </div>
    </div>
    }

    <div class="form-group">
        <label for="chapters">{{ 'form.chapters.label' | transloco }}</label>
        <input id="chapters" type="number" formControlName="chapters" required min="0" />
        @if (mangaForm.get('chapters')?.touched && mangaForm.get('chapters')?.invalid) {
        <div class="error">{{ 'errors.chapters.invalid' | transloco }}</div>
        }
    </div>

    <div class="form-group favorite-container">
        <label for="isFavorite">{{ 'form.favorite.label' | transloco }}</label>
        <input id="isFavorite" type="checkbox" formControlName="isFavorite" />
    </div>

    <div class="form-group">
        <label for="type">{{ 'form.type.label' | transloco }}</label>
        <select id="type" formControlName="type">
            <option value="manga">Manga</option>
            <option value="manhwa">Manhwa</option>
            <option value="manhua">Manhua</option>
        </select>
    </div>

    <div class="form-group">
        <label for="state">{{ 'form.state.label' | transloco }}</label>
        <select id="state" formControlName="state">
            <option value="reading">Reading</option>
            <option value="completed">Completed</option>
            <option value="on-hold">On-Hold</option>
        </select>
    </div>

    <div class="form-group">
        <label for="tags">{{ 'form.tags.label' | transloco }}</label>
        <input id="tags" formControlName="tags" />
    </div>

    <button type="submit" [disabled]="mangaForm.invalid">{{ 'common.save' | transloco }}</button>
</form>